@model FamilyRegistration.ViewModels.AddChildViewModel

@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section styles
{
<link href="~/Content/date-picker/bootstrap-datepicker.css" rel="stylesheet" />
    }

<div class="auth-box register">
    <div class="content">
        <div class="header">
            <p class="lead">
                <b style="text-transform: uppercase">@Model.Person.FamilyName</b> You currently have a total of <b>@Model.Person.FamilyMembers</b> family members including yourself. Add additonal children to your family below.
            </p>
        </div>
        @if (!ViewData.ModelState.IsValid)
        {
            string messages = string.Join(", ", ViewData.ModelState.Values
                                        .SelectMany(x => x.Errors)
                                        .Select(x => x.ErrorMessage));
            <div class="alert alert-danger alert-dismissible required-alert" style="margin-top: 5px;" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
                <i class="fa fa-times-circle"></i> <b>Invalid Information</b> @messages
            </div>
        }
        <div class="alert alert-danger alert-dismissible hidden required-alert" style="margin-top: 5px;" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
            <i class="fa fa-times-circle"></i> <b>Missing Information</b> Hey, each child needs a name and birthdate to be successfully added. Thanks!
        </div>
        <div id="loading" class="hidden text-center">
            <i class="fa fa-spinner fa-spin fa-3x"></i>
        </div>
        @using (Html.BeginForm("AddChildren", "Home", new { @class = "form-auth-small" }))
        {
            <div class="separator-linethrough"><span>ADDITIONAL CHILD FAMILY MEMBERS</span></div>
            <div id="children">
                @for (int i = 0; i < Model.NewChildFamilyMembers.Count; i++)
                {
                    <div class="form-group child-@i">
                        <input type="hidden" name="NewChildFamilyMembers.Index" value="@i" />
                        @Html.HiddenFor(m => m.NewChildFamilyMembers[i].FamilyId, new { @value = Model.Person.FamilyId })
                        @Html.HiddenFor(m => m.NewChildFamilyMembers[i].FamilyName, new { @value = Model.Person.FamilyName })
                        <div class="row">
                            <div class="col-md-3 minimize-col-padding">
                                @Html.TextBoxFor(m => m.NewChildFamilyMembers[i].FirstName, new { @class = "form-control input-lg", @placeholder = "First Name", @required = "required" })
                            </div>
                            <div class="col-md-3 minimize-col-padding">
                                @Html.TextBoxFor(m => m.NewChildFamilyMembers[i].LastName, new { @class = "form-control input-lg", @placeholder = "Last Name", @required = "required" })
                            </div>
                            <div class="col-md-3 minimize-col-padding">
                                @Html.TextBoxFor(m => m.NewChildFamilyMembers[i].BirthDate, new { @class = "form-control input-lg", @placeholder = "Birthdate", @required = "required", @data_provide = "datepicker", @data_date_autoclose="true", @Value="" })
                            </div>
                            <div class="col-md-2 minimize-col-padding">
                                @Html.DropDownListFor(m => m.NewChildFamilyMembers[i].Gender, Model.Genders, new { @class = "form-control input-lg", @placeholder = "Gender", @required = "required" })
                            </div>
                            <div class="col-md-1 minimize-col-padding">
                                <button data-child="@i" class="btn btn-lg btn-block remove-child-button" style="padding: 10px 20px; margin-top: 0px"><i class="fa fa-trash"></i></button>
                            </div>
                        </div>
                    </div>
                }

            </div>

            <button class="btn btn-neutral btn-lg btn-block add-child-button">Add Child</button>
            <button type="button" id="form-submit-button" class="btn btn-success btn-lg btn-block" style="margin-top: 15px">FINISHED</button>
        }
        <div class="bottom text-center margin-top-30">
            <span class="helper-text">Make a wrong turn? <a href="@Url.Action("Index")">Go Back</a></span>
        </div>
    </div>
</div>

@section Scripts
{
    <script src="~/Scripts/bootstrap-datepicker.min.js"></script>
    <script type="text/javascript">
        $(function () {
            $('.inline-datepicker').datepicker({
                todayHighlight: true
            });
        });

        var index = 1;

        $('.add-child-button').click(function (e) {
            e.preventDefault();
            var str = '<div class="form-group child-index"><input type="hidden" name="NewNewChildFamilyMembers.Index" value="index" /><input type="hidden" name="NewChildFamilyMembers[index].FamilyId" value="@Model.Person.FamilyId" /><input type="hidden" name="NewChildFamilyMembers[index].FamilyName" value="@Model.Person.FamilyName" /><div class="row"> <div class="col-md-3 minimize-col-padding"> <input class="form-control input-lg" id="NewFamilyModel_NewFamilyMembers_index__FirstName" name="NewFamilyModel.NewFamilyMembers[index].FirstName" placeholder="First Name" type="text" value="" required="required"> </div><div class="col-md-3 minimize-col-padding"> <input class="form-control input-lg" id="NewFamilyModel_NewFamilyMembers_index__LastName" name="NewFamilyModel.NewFamilyMembers[index].LastName" placeholder="Last Name" type="text" value="" required="required"> </div><div class="col-md-3 minimize-col-padding"> <input class="form-control input-lg" id="NewFamilyModel_NewFamilyMembers_index__Email" name="NewFamilyModel.NewFamilyMembers[index].Email" placeholder="myemail@mydomain.com" type="text" value="" required="required"> </div><div class="col-md-2 minimize-col-padding"> <input class="form-control input-lg phone" id="NewFamilyModel_NewFamilyMembers_index__PhoneNumber" name="NewFamilyModel.NewFamilyMembers[index].PhoneNumber" placeholder="(502)123-4567" type="text" value="" required="required"> </div><div class="col-md-1 minimize-col-padding"><button data-adult="index" class="btn btn-lg btn-block remove-adult-button" style="padding: 10px 20px; margin-top: 0px"><i class="fa fa-trash" /></button></div></div></div>';
        str = str.replace(/index/g, index);

        $('#children').append(str);
        $('.inline-datepicker').datepicker({
            todayHighlight: true
        });
        index = index + 1;
    });

    $(document).on('click', '.remove-child-button', function (e) {
        e.preventDefault();
        var thisIndex = $(this).data("child");
        $('.child-' + thisIndex).remove();
    });

    $(document).on('blur', 'form :input[required]', function (e) {
        if ($(this).hasClass("input-required")) {
            if ($.trim($(this).val()).length > 0) $(this).removeClass("input-required");
            if ($("form .input-required").length == 0) { $(".required-alert").addClass("hidden"); }
        }
    });

    $("#form-submit-button").click(function () {

        $("#form-submit-button").prop("disabled", true);

        // Remove all redborders
        $("form :input.input-required").removeClass("input-required");
        // Check all required fields have text, you can even check other values
        $("form :input[required]").each(function () {
            if ($.trim($(this).val()) == "") $(this).addClass("input-required");
        });
        // If any input has a red border, return
        if ($("form .input-required").length > 0) {
            $("#form-submit-button").prop("disabled", false);
            $(".required-alert").removeClass("hidden");
            return;
        }

        $(".required-alert").addClass("hidden");
        //hide everything before we submit
        $('.form-auth-small').addClass("hidden");
        $('#loading').removeClass("hidden");
        $('#form-submit-button').addClass("disabled");
        $('.add-child-button').addClass("disabled");
        $('form').submit();
    });

    </script>
}